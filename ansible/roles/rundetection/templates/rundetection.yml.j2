---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: rundetection
  namespace: ir
spec:
  replicas: 1
  selector:
    matchLabels:
      app: rundetection
  template:
    metadata:
      labels:
        app: rundetection
    spec:
      containers:
      - name: rundetection
        image: ghcr.io/interactivereduction/rundetection@sha256:895fb8e09a344c35ff03a5d96f6ff86918c79a0242397f9cf3a002f9ee3aa576
        env:
        - name: ACTIVEMQ_IP
          value: "{{ active_mq_prod.ip }}"
        - name: ACTIVEMQ_USER
          value: "{{ active_mq_prod.username }}"
        - name: ACTIVEMQ_PASS
          value: "{{ active_mq_prod.password }}"
        - name: ACTIVEMQ_QUEUE
          value: detected-runs
        - name: KAFKA_IP
          value: kafka-cluster-kafka-bootstrap.kafka.svc.cluster.local # Using the DNS service this will resolve to an actual IP address to the kafka service
        volumeMounts:
          - name: archive-mount
            mountPath: /archive
      volumes:
        - name: archive-mount
          hostPath:
            type: Directory
            path: /archive