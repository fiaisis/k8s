---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: rundetection
  namespace: ir
spec:
  replicas: 1
  selector:
    matchLabels:
      app: rundetection
  template:
    metadata:
      labels:
        app: rundetection
    spec:
      containers:
      - name: rundetection
        image: ghcr.io/interactivereduction/rundetection@sha256:1583477090957a4ad7cd405e9bb028be29290a457c8b9ffd62d8614c9c9ecd60
        env:
        - name: ACTIVEMQ_IP
          value: "{{ active_mq_prod.ip }}"
        - name: ACTIVEMQ_USER
          value: "{{ active_mq_prod.username }}"
        - name: ACTIVEMQ_PASS
          value: "{{ active_mq_prod.password }}"
        - name: ACTIVEMQ_QUEUE
          value: detected-runs
        - name: KAFKA_IP
          value: kafka-cluster-kafka-bootstrap.kafka.svc.cluster.local # Using the DNS service this will resolve to an actual IP address to the kafka service
        volumeMounts:
          - name: archive-mount
            mountPath: /archive
      volumes:
        - name: archive-mount
          hostPath:
            type: Directory
            path: /archive